kind: pipeline
name: Fuu CI/CD Pipeline

steps:
- name: Buildx and push to docker hub
  image: jdrouet/docker-with-buildx:stable
  volumes:
  - name: dockersock
    path: /var/run
  environment:
    USERNAME:
      from_secret: DOCKER_HUB_USER
    PASSWORD:
      from_secret: DOCKER_HUB_PASS
  commands:
  - sleep 10
  - docker login -u $USERNAME -p $PASSWORD
  - docker buildx create --use
  - docker buildx build --push --platform linux/amd64 --tag "$USERNAME/fuu:latest" .
  - echo "Pipeline completed!"

services:
- name: docker
  image: docker:dind
  privileged: true
  volumes:
  - name: dockersock
    path: /var/run

volumes:
- name: dockersock
  temp: {}